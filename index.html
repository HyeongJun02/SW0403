<!DOCTYPE html>
<html>
<head>
    <title>Chat App</title>
</head>
<body>
    <!-- 채팅 내용 -->
    <div id="chat"></div>
    <!-- 채팅 입력란 (input box) -->
    <input type="text" id="messageInput" placeholder="Type a message...">
    <!-- 전송 버튼 -->
    <button onclick="sendMessage()">Send</button>

    <!-- Java Script 코드 작성 -->
    <script>
        const ws = new WebSocket('ws://localhost:8080');
        // chat이라는 id를 가진 element를 가져옴 (chat에는 div가 들어있음)
        const chat = document.getElementById('chat');
        const messageInput = document.getElementById('messageInput');

        // 이벤트가 발생했는지 확인
        ws.onmessage = function(event) {
            // event.data가 Blob 인스턴스일 경우 FileReader를 사용해서 읽어오기
            if (event.data instanceof Blob) {
                const reader = new FileReader();
                reader.onload = function() {
                    // p: <p> Tag
                    const message = document.createElement('p');
                    message.textContent = reader.result;
                    // chat(div)에다 message를 붙인다. (한 줄 씩 내려가며 저장됨)
                    chat.appendChild(message);
                };
                reader.readAsText(event.data);
            } else {
                // 메시지가 문자열인 경우, 직접 표시
                // p: <p> Tag
                const message = document.createElement('p');
                message.textContent = event.data;
                chat.appendChild(message);
            }
        };

        function sendMessage() {
            // messageInput의 값을 불러와서
            const message = messageInput.value;
            // 서버 쪽으로 내 text 전달하는 부분
            ws.send(message);
            // 메시지 안의 text를 지움
            messageInput.value = '';
        }
    </script>
</body>
</html>
